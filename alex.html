<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vores flotte miniprojekt</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
      background: #f5f5f5;
    }
    h1, h2 {
      text-align: center;
    }
    .card {
      background: #ffffff;
      border-radius: 8px;
      padding: 1rem 1.5rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 1.5rem;
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-family: inherit;
      font-size: 0.95rem;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    button {
      padding: 0.5rem 1rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    button.primary {
      background: #2563eb;
      color: white;
    }
    button.secondary {
      background: #e5e7eb;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .hidden { display: none; }
    .status {
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }
    .status.ok { color: #16a34a; }
    .status.error { color: #dc2626; }
    pre {
      background: #111827;
      color: #e5e7eb;
      padding: 0.75rem;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <h1>AI-Systems & Infrastructure â€“ Miniproject</h1>

  <div id="connect-screen" class="card">
    <h2>Connect to Server</h2>
    <p>Enter the <strong>IP address</strong> or full URL of the FastAPI server.</p>
    <label for="server-input">Server IP or URL</label>
    <input
      type="text"
      id="server-input"
      placeholder="e.g. 127.0.0.1  or  http://127.0.0.1:8000"
    />
    <button id="connect-button" class="primary">Connect</button>
    <div id="connect-status" class="status"></div>
  </div>

  <div id="client-screen" class="card hidden">
    <h2>Connected</h2>
    <p>
      Connected to:
      <strong id="server-label"></strong>
    </p>

    <div class="card" style="background:#f9fafb;">
      <h3>Server info (GET /)</h3>
      <button id="btn-root" class="secondary">Call GET /</button>
    </div>

    <div class="card" style="background:#f9fafb;">
      <h3>Simple Chat (POST /v1/simple-chat)</h3>
      <label for="prompt-input">Prompt</label>
      <textarea id="prompt-input" placeholder="Skriv din prompt her..."></textarea>
      <button id="btn-chat" class="primary">Send til /v1/simple-chat</button>
    </div>

    <h3>Result</h3>
    <pre id="result-box">// Responses will appear here</pre>
  </div>

  <script>
    let baseUrl = null;

    const connectScreen = document.getElementById("connect-screen");
    const clientScreen = document.getElementById("client-screen");
    const serverInput = document.getElementById("server-input");
    const connectButton = document.getElementById("connect-button");
    const connectStatus = document.getElementById("connect-status");
    const serverLabel = document.getElementById("server-label");
    const resultBox = document.getElementById("result-box");
    const promptInput = document.getElementById("prompt-input");
    const btnRoot = document.getElementById("btn-root");
    const btnChat = document.getElementById("btn-chat");

    function normaliseBaseUrl(raw) {
      raw = raw.trim();
      if (!raw) return null;
      if (raw.startsWith("http://") || raw.startsWith("https://")) {
        return raw.replace(/\/+$/, "");
      }
      return "http://" + raw + ":8000";
    }

    async function testConnection(url) {
      const resp = await fetch(url + "/");
      if (!resp.ok) {
        throw new Error("GET / failed with status " + resp.status);
      }
      return resp.json();
    }

    connectButton.addEventListener("click", async () => {
      connectStatus.textContent = "";
      connectStatus.className = "status";
      const raw = serverInput.value;
      const url = normaliseBaseUrl(raw);

      if (!url) {
        connectStatus.textContent = "Please enter a valid IP or URL.";
        connectStatus.classList.add("error");
        return;
      }

      connectButton.disabled = true;
      connectStatus.textContent = "Connecting...";
      try {
        const info = await testConnection(url);
        baseUrl = url;
        serverLabel.textContent = baseUrl;
        connectStatus.textContent = "Connected! GET / returned: " + JSON.stringify(info);
        connectStatus.classList.add("ok");
        connectScreen.classList.add("hidden");
        clientScreen.classList.remove("hidden");
      } catch (err) {
        console.error(err);
        connectStatus.textContent = "Failed to connect: " + err.message;
        connectStatus.classList.add("error");
      } finally {
        connectButton.disabled = false;
      }
    });

    async function callEndpoint(path, options = {}) {
      if (!baseUrl) throw new Error("Not connected yet.");
      const resp = await fetch(baseUrl + path, options);
      const text = await resp.text();
      try {
        const parsed = JSON.parse(text);
        return JSON.stringify(parsed, null, 2);
      } catch {
        return text;
      }
    }

    btnRoot.addEventListener("click", async () => {
      resultBox.textContent = "Calling GET / ...";
      try {
        const res = await callEndpoint("/");
        resultBox.textContent = res;
      } catch (err) {
        resultBox.textContent = "Error: " + err.message;
      }
    });

    btnChat.addEventListener("click", async () => {
      const prompt = promptInput.value.trim();
      if (!prompt) {
        resultBox.textContent = "Please enter a prompt first.";
        return;
      }
      resultBox.textContent = "Calling POST /v1/simple-chat ...";
      try {
        const res = await callEndpoint("/v1/simple-chat", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ prompt: prompt })
        });
        resultBox.textContent = res;
      } catch (err) {
        resultBox.textContent = "Error: " + err.message;
      }
    });
  </script>
</body>
</html>